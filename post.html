<!DOCTYPE html>
  <head>
    <title>bronen.github.io</title>
    <style>
      body{
        padding: 5px;
        background-color: #101010;
      }
      *{
        box-sizing: border-box;
      }
      #root{
        color: #5b5;
        padding: 20px;
        background-color: #333;
        border: 2px solid #222;
        border-radius: 10px;
      }
    </style>
    <script>

      const State = {};

      const parser = document.createElement("a");
      parser.href = window.location.href;
      State.params = parser.search.split("=");

      window.addEventListener('load', () => {
        if(State.params[0] == '?post'){
          renderPost('https://api.github.com/repos/BRonen/bronen.github.io/issues/'+State.params[1]);
        }
      });

      function renderPost(url){
        axios.get(url, {
          headers: {
            'content-type': 'application/json'
          }
        } ).then(response => {
          State.post = response.data;
          setupDom();
        }).catch(err => {
          setupDomError(err);
        });
      }

      function renderNext(){
        const issueNum = 1 + Number(State.params[1]);

        let newHref = window.location.href.slice(0, -1) + issueNum;

        window.location.href = newHref;
      }

      function renderPrevious(){
        const issueNum = Number(State.params[1]) - 1;

        let newHref = window.location.href.slice(0, -1) + issueNum;

        window.location.href = newHref;
      }

      function setupDom(){
        document.title = State.post.title;

        window["markdown"].ready.then(markdown => {
          document.getElementById('root').innerHTML = markdown.parse(State.post.body);
        });
      }

      function setupDomError(err){
        document.title = "Post Error";

        document.getElementById('root').innerHTML = err;
      }

    </script>
  </head>
  <body>
    <a href="/">
      <button>Home</button>
    </a>
    <div id="root">
    </div>
    <button onClick="renderPrevious()">Previous</button> <button onClick="renderNext()">Next</button>
    <script src="js/markdown/markdown.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </body>
</html>
